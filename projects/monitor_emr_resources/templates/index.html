<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EMR Job Resource Monitor</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        .status-completed { background-color: #d4edda; color: #155724; }
        .status-failed { background-color: #f8d7da; color: #721c24; }
        .status-error { background-color: #fff3cd; color: #856404; }
        .status-running { background-color: #cce7ff; color: #004085; }
        .table-container { max-height: 500px; overflow-y: auto; }
        .metric-card { transition: transform 0.2s; }
        .metric-card:hover { transform: translateY(-2px); }
        .loading { display: none; }
        .loading.show { display: block; }
        .tab-content { min-height: 400px; }
        .filter-section { background-color: #f8f9fa; padding: 15px; border-radius: 5px; margin-bottom: 20px; }
        .no-data { text-align: center; padding: 40px; color: #6c757d; }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <div class="col-12">
                <h1 class="text-center mt-3 mb-4">
                    <i class="fas fa-server"></i> EMR Job Resource Monitor
                </h1>

                <!-- Configuration Section -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5><i class="fas fa-cog"></i> Configuration</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-5">
                                <label for="sparkUrl" class="form-label">Spark History Server URL</label>
                                <input type="text" class="form-control" id="sparkUrl"
                                       value="http://your-master-node:18080" placeholder="Enter Spark History Server URL">
                            </div>
                            <div class="col-md-5">
                                <label for="yarnUrl" class="form-label">YARN Resource Manager URL</label>
                                <input type="text" class="form-control" id="yarnUrl"
                                       value="http://your-master-node:8088" placeholder="Enter YARN Resource Manager URL">
                            </div>
                            <div class="col-md-2 d-flex align-items-end">
                                <button class="btn btn-primary w-100" onclick="refreshData()">
                                    <i class="fas fa-sync-alt"></i> Refresh Data
                                </button>
                            </div>
                        </div>
                        <div class="mt-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="autoRefresh">
                                <label class="form-check-label" for="autoRefresh">
                                    Auto-refresh every 30 seconds
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Loading Indicator -->
                <div class="loading text-center">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <p class="mt-2">Loading job data...</p>
                </div>

                <!-- Tabs -->
                <ul class="nav nav-tabs" id="jobTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="running-tab" data-bs-toggle="tab" data-bs-target="#running"
                                type="button" role="tab">
                            <i class="fas fa-play-circle"></i> Running Jobs
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="completed-tab" data-bs-toggle="tab" data-bs-target="#completed"
                                type="button" role="tab">
                            <i class="fas fa-check-circle"></i> Completed Jobs
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="hourly-tab" data-bs-toggle="tab" data-bs-target="#hourly"
                                type="button" role="tab">
                            <i class="fas fa-chart-bar"></i> Hourly Aggregation
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="summary-tab" data-bs-toggle="tab" data-bs-target="#summary"
                                type="button" role="tab">
                            <i class="fas fa-list"></i> Job Summary
                        </button>
                    </li>
                </ul>

                <!-- Tab Content -->
                <div class="tab-content" id="jobTabsContent">
                    <!-- Running Jobs Tab -->
                    <div class="tab-pane fade show active" id="running" role="tabpanel">
                        <div class="mt-3">
                            <!-- Summary Cards -->
                            <div class="row mb-4" id="runningSummary">
                                <div class="col-md-3">
                                    <div class="card metric-card bg-primary text-white">
                                        <div class="card-body">
                                            <h5>Total Running Jobs</h5>
                                            <h3 id="runningJobsCount">0</h3>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="card metric-card bg-info text-white">
                                        <div class="card-body">
                                            <h5>Total Memory (GB)</h5>
                                            <h3 id="runningMemory">0</h3>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="card metric-card bg-success text-white">
                                        <div class="card-body">
                                            <h5>Total vCores</h5>
                                            <h3 id="runningVCores">0</h3>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="card metric-card bg-warning text-white">
                                        <div class="card-body">
                                            <h5>Total Containers</h5>
                                            <h3 id="runningContainers">0</h3>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Filters -->
                            <div class="filter-section">
                                <div class="row">
                                    <div class="col-md-3">
                                        <label class="form-label">Filter by Job Name</label>
                                        <select class="form-select" id="runningJobFilter">
                                            <option value="">All Jobs</option>
                                        </select>
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label">Filter by User</label>
                                        <select class="form-select" id="runningUserFilter">
                                            <option value="">All Users</option>
                                        </select>
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label">Min Memory (GB)</label>
                                        <input type="number" class="form-control" id="runningMemoryFilter"
                                               min="0" step="0.1" value="0">
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label">Sort By</label>
                                        <select class="form-select" id="runningSortBy">
                                            <option value="Submit Time">Submit Time</option>
                                            <option value="Memory (GB)">Memory (GB)</option>
                                            <option value="vCores">vCores</option>
                                            <option value="Elapsed Time (mins)">Elapsed Time (mins)</option>
                                            <option value="Progress (%)">Progress (%)</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="row mt-2">
                                    <div class="col-md-3">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="runningSortAsc">
                                            <label class="form-check-label" for="runningSortAsc">Ascending</label>
                                        </div>
                                    </div>
                                    <div class="col-md-9 text-end">
                                        <button class="btn btn-outline-primary" onclick="applyRunningFilters()">
                                            <i class="fas fa-filter"></i> Apply Filters
                                        </button>
                                        <button class="btn btn-outline-success" onclick="downloadCSV('running')">
                                            <i class="fas fa-download"></i> Download CSV
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Table -->
                            <div class="table-container">
                                <table class="table table-striped table-hover" id="runningJobsTable">
                                    <thead class="table-dark sticky-top">
                                        <tr id="runningTableHeader"></tr>
                                    </thead>
                                    <tbody id="runningTableBody"></tbody>
                                </table>
                            </div>
                            <div class="no-data" id="runningNoData" style="display: none;">
                                <i class="fas fa-info-circle fa-3x"></i>
                                <h4>No jobs currently running</h4>
                            </div>
                        </div>
                    </div>

                    <!-- Completed Jobs Tab -->
                    <div class="tab-pane fade" id="completed" role="tabpanel">
                        <div class="mt-3">
                            <!-- Summary Cards -->
                            <div class="row mb-4" id="completedSummary">
                                <div class="col-md-3">
                                    <div class="card metric-card bg-primary text-white">
                                        <div class="card-body">
                                            <h5>Total Completed</h5>
                                            <h3 id="completedJobsCount">0</h3>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="card metric-card bg-info text-white">
                                        <div class="card-body">
                                            <h5>Memory-Hours</h5>
                                            <h3 id="completedMemoryHours">0</h3>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="card metric-card bg-success text-white">
                                        <div class="card-body">
                                            <h5>vCore-Hours</h5>
                                            <h3 id="completedVCoreHours">0</h3>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="card metric-card bg-warning text-white">
                                        <div class="card-body">
                                            <h5>Success Rate</h5>
                                            <h3 id="completedSuccessRate">0%</h3>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Filters -->
                            <div class="filter-section">
                                <div class="row">
                                    <div class="col-md-2">
                                        <label class="form-label">Job Name</label>
                                        <select class="form-select" id="completedJobFilter">
                                            <option value="">All Jobs</option>
                                        </select>
                                    </div>
                                    <div class="col-md-2">
                                        <label class="form-label">User</label>
                                        <select class="form-select" id="completedUserFilter">
                                            <option value="">All Users</option>
                                        </select>
                                    </div>
                                    <div class="col-md-2">
                                        <label class="form-label">Status</label>
                                        <select class="form-select" id="completedStatusFilter">
                                            <option value="">All Status</option>
                                        </select>
                                    </div>
                                    <div class="col-md-2">
                                        <label class="form-label">Last N Hours</label>
                                        <input type="number" class="form-control" id="completedHoursFilter"
                                               min="1" value="24">
                                    </div>
                                    <div class="col-md-2">
                                        <label class="form-label">Sort By</label>
                                        <select class="form-select" id="completedSortBy">
                                            <option value="Submit Time">Submit Time</option>
                                            <option value="Duration (mins)">Duration (mins)</option>
                                            <option value="Memory (GB)">Memory (GB)</option>
                                            <option value="vCores">vCores</option>
                                            <option value="Memory-Hours">Memory-Hours</option>
                                            <option value="vCore-Hours">vCore-Hours</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="row mt-2">
                                    <div class="col-md-3">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="completedSortAsc">
                                            <label class="form-check-label" for="completedSortAsc">Ascending</label>
                                        </div>
                                    </div>
                                    <div class="col-md-9 text-end">
                                        <button class="btn btn-outline-primary" onclick="applyCompletedFilters()">
                                            <i class="fas fa-filter"></i> Apply Filters
                                        </button>
                                        <button class="btn btn-outline-success" onclick="downloadCSV('completed')">
                                            <i class="fas fa-download"></i> Download CSV
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Table -->
                            <div class="table-container">
                                <table class="table table-striped table-hover" id="completedJobsTable">
                                    <thead class="table-dark sticky-top">
                                        <tr id="completedTableHeader"></tr>
                                    </thead>
                                    <tbody id="completedTableBody"></tbody>
                                </table>
                            </div>
                            <div class="no-data" id="completedNoData" style="display: none;">
                                <i class="fas fa-info-circle fa-3x"></i>
                                <h4>No completed jobs found</h4>
                            </div>
                        </div>
                    </div>

                    <!-- Hourly Aggregation Tab -->
                    <div class="tab-pane fade" id="hourly" role="tabpanel">
                        <div class="mt-3">
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label class="form-label">Show last N hours</label>
                                    <input type="range" class="form-range" id="hourlyRange"
                                           min="6" max="168" value="48" oninput="updateHourlyRange()">
                                    <div class="d-flex justify-content-between">
                                        <small>6 hours</small>
                                        <small id="hourlyRangeValue">48 hours</small>
                                        <small>168 hours</small>
                                    </div>
                                </div>
                                <div class="col-md-6 text-end">
                                    <button class="btn btn-outline-success" onclick="downloadCSV('hourly')">
                                        <i class="fas fa-download"></i> Download CSV
                                    </button>
                                </div>
                            </div>

                            <!-- Summary Statistics -->
                            <div class="card mb-3">
                                <div class="card-header">
                                    <h5><i class="fas fa-chart-line"></i> Summary Statistics</h5>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-sm" id="hourlySummaryTable">
                                            <tbody></tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>

                            <!-- Hourly Data Table -->
                            <div class="table-container">
                                <table class="table table-striped table-hover" id="hourlyTable">
                                    <thead class="table-dark sticky-top">
                                        <tr id="hourlyTableHeader"></tr>
                                    </thead>
                                    <tbody id="hourlyTableBody"></tbody>
                                </table>
                            </div>
                            <div class="no-data" id="hourlyNoData" style="display: none;">
                                <i class="fas fa-info-circle fa-3x"></i>
                                <h4>No data available for aggregation</h4>
                            </div>
                        </div>
                    </div>

                    <!-- Job Summary Tab -->
                    <div class="tab-pane fade" id="summary" role="tabpanel">
                        <div class="mt-3">
                            <!-- Filters -->
                            <div class="filter-section">
                                <div class="row">
                                    <div class="col-md-4">
                                        <label class="form-label">Min number of runs</label>
                                        <input type="number" class="form-control" id="summaryMinRuns"
                                               min="1" value="1">
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label">Min Memory-Hours</label>
                                        <input type="number" class="form-control" id="summaryMinMemoryHours"
                                               min="0" step="0.1" value="0">
                                    </div>
                                    <div class="col-md-4 text-end">
                                        <label class="form-label">&nbsp;</label>
                                        <div>
                                            <button class="btn btn-outline-primary" onclick="applySummaryFilters()">
                                                <i class="fas fa-filter"></i> Apply Filters
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Job Summary Table -->
                            <div class="table-container">
                                <table class="table table-striped table-hover" id="summaryTable">
                                    <thead class="table-dark sticky-top">
                                        <tr id="summaryTableHeader"></tr>
                                    </thead>
                                    <tbody id="summaryTableBody"></tbody>
                                </table>
                            </div>
                            <div class="no-data" id="summaryNoData" style="display: none;">
                                <i class="fas fa-info-circle fa-3x"></i>
                                <h4>No job data available for summary</h4>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script>
        let jobData = {
            running: [],
            completed: [],
            hourly: [],
            summary: []
        };

        let autoRefreshInterval;

        // Auto-refresh functionality
        document.getElementById('autoRefresh').addEventListener('change', function() {
            if (this.checked) {
                autoRefreshInterval = setInterval(refreshData, 30000);
            } else {
                clearInterval(autoRefreshInterval);
            }
        });

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            refreshData();
        });

        function showLoading() {
            document.querySelector('.loading').classList.add('show');
        }

        function hideLoading() {
            document.querySelector('.loading').classList.remove('show');
        }

        async function refreshData() {
            showLoading();
            const sparkUrl = document.getElementById('sparkUrl').value;
            const yarnUrl = document.getElementById('yarnUrl').value;

            try {
                // Load all data
                await Promise.all([
                    loadRunningJobs(sparkUrl, yarnUrl),
                    loadCompletedJobs(sparkUrl, yarnUrl),
                    loadHourlyAggregation(sparkUrl, yarnUrl),
                    loadJobSummary(sparkUrl, yarnUrl)
                ]);
            } catch (error) {
                console.error('Error refreshing data:', error);
                alert('Error loading data: ' + error.message);
            } finally {
                hideLoading();
            }
        }

        async function loadRunningJobs(sparkUrl, yarnUrl) {
            const response = await fetch(`/api/running-jobs?spark_url=${encodeURIComponent(sparkUrl)}&yarn_url=${encodeURIComponent(yarnUrl)}`);
            const data = await response.json();

            jobData.running = data.data;
            updateRunningSummary(data.summary);
            updateRunningTable(data.data, data.columns);
            populateRunningFilters(data.data);
        }

        async function loadCompletedJobs(sparkUrl, yarnUrl) {
            const response = await fetch(`/api/completed-jobs?spark_url=${encodeURIComponent(sparkUrl)}&yarn_url=${encodeURIComponent(yarnUrl)}`);
            const data = await response.json();

            jobData.completed = data.data;
            updateCompletedSummary(data.summary);
            updateCompletedTable(data.data, data.columns);
            populateCompletedFilters(data.data);
        }

        async function loadHourlyAggregation(sparkUrl, yarnUrl) {
            const response = await fetch(`/api/hourly-aggregation?spark_url=${encodeURIComponent(sparkUrl)}&yarn_url=${encodeURIComponent(yarnUrl)}`);
            const data = await response.json();

            jobData.hourly = data.data;
            updateHourlyTable(data.data, data.columns);
            updateHourlySummary(data.summary);
        }

        async function loadJobSummary(sparkUrl, yarnUrl) {
            const response = await fetch(`/api/job-summary?spark_url=${encodeURIComponent(sparkUrl)}&yarn_url=${encodeURIComponent(yarnUrl)}`);
            const data = await response.json();

            jobData.summary = data.data;
            updateSummaryTable(data.data, data.columns);
        }

        function updateRunningSummary(summary) {
            document.getElementById('runningJobsCount').textContent = summary.total_jobs || 0;
            document.getElementById('runningMemory').textContent = summary.total_memory || 0;
            document.getElementById('runningVCores').textContent = summary.total_vcores || 0;
            document.getElementById('runningContainers').textContent = summary.total_containers || 0;
        }

        function updateCompletedSummary(summary) {
            document.getElementById('completedJobsCount').textContent = summary.total_jobs || 0;
            document.getElementById('completedMemoryHours').textContent = summary.total_memory_hours || 0;
            document.getElementById('completedVCoreHours').textContent = summary.total_vcore_hours || 0;
            document.getElementById('completedSuccessRate').textContent = (summary.success_rate || 0) + '%';
        }

        function updateRunningTable(data, columns) {
            const noDataDiv = document.getElementById('runningNoData');
            const table = document.getElementById('runningJobsTable');

            if (!data || data.length === 0) {
                noDataDiv.style.display = 'block';
                table.style.display = 'none';
                return;
            }

            noDataDiv.style.display = 'none';
            table.style.display = 'table';

            // Update header
            const header = document.getElementById('runningTableHeader');
            header.innerHTML = columns.map(col => `<th>${col}</th>`).join('');

            // Update body
            const body = document.getElementById('runningTableBody');
            body.innerHTML = data.map(row => {
                const cells = columns.map(col => {
                    let value = row[col] || '';
                    let cellClass = '';

                    if (col === 'Status') {
                        cellClass = `status-${value.toLowerCase()}`;
                    }

                    return `<td class="${cellClass}">${value}</td>`;
                }).join('');
                return `<tr>${cells}</tr>`;
            }).join('');
        }

        function updateCompletedTable(data, columns) {
            const noDataDiv = document.getElementById('completedNoData');
            const table = document.getElementById('completedJobsTable');

            if (!data || data.length === 0) {
                noDataDiv.style.display = 'block';
                table.style.display = 'none';
                return;
            }

            noDataDiv.style.display = 'none';
            table.style.display = 'table';

            // Update header
            const header = document.getElementById('completedTableHeader');
            header.innerHTML = columns.map(col => `<th>${col}</th>`).join('');

            // Update body
            const body = document.getElementById('completedTableBody');
            body.innerHTML = data.map(row => {
                const cells = columns.map(col => {
                    let value = row[col] || '';
                    let cellClass = '';

                    if (col === 'Status') {
                        cellClass = `status-${value.toLowerCase()}`;
                    }

                    return `<td class="${cellClass}">${value}</td>`;
                }).join('');
                return `<tr>${cells}</tr>`;
            }).join('');
        }

        function updateHourlyTable(data, columns) {
            const noDataDiv = document.getElementById('hourlyNoData');
            const table = document.getElementById('hourlyTable');

            if (!data || data.length === 0) {
                noDataDiv.style.display = 'block';
                table.style.display = 'none';
                return;
            }

            noDataDiv.style.display = 'none';
            table.style.display = 'table';

            // Update header
            const header = document.getElementById('hourlyTableHeader');
            header.innerHTML = columns.map(col => `<th>${col}</th>`).join('');

            // Update body (limit to range value)
            const range = parseInt(document.getElementById('hourlyRange').value);
            const limitedData = data.slice(0, range);

            const body = document.getElementById('hourlyTableBody');
            body.innerHTML = limitedData.map(row => {
                const cells = columns.map(col => `<td>${row[col] || ''}</td>`).join('');
                return `<tr>${cells}</tr>`;
            }).join('');
        }

        function updateHourlySummary(summary) {
            const table = document.getElementById('hourlySummaryTable');
            const tbody = table.querySelector('tbody');

            if (!summary || Object.keys(summary).length === 0) {
                tbody.innerHTML = '<tr><td>No summary data available</td></tr>';
                return;
            }

            tbody.innerHTML = Object.entries(summary).map(([key, value]) =>
                `<tr><td><strong>${key}</strong></td><td>${value}</td></tr>`
            ).join('');
        }

        function updateSummaryTable(data, columns) {
            const noDataDiv = document.getElementById('summaryNoData');
            const table = document.getElementById('summaryTable');

            if (!data || data.length === 0) {
                noDataDiv.style.display = 'block';
                table.style.display = 'none';
                return;
            }

            noDataDiv.style.display = 'none';
            table.style.display = 'table';

            // Update header
            const header = document.getElementById('summaryTableHeader');
            header.innerHTML = columns.map(col => `<th>${col}</th>`).join('');

            // Update body
            const body = document.getElementById('summaryTableBody');
            body.innerHTML = data.map(row => {
                const cells = columns.map(col => `<td>${row[col] || ''}</td>`).join('');
                return `<tr>${cells}</tr>`;
            }).join('');
        }

        function populateRunningFilters(data) {
            populateSelectFilter('runningJobFilter', data, 'Job Name');
            populateSelectFilter('runningUserFilter', data, 'User');
        }

        function populateCompletedFilters(data) {
            populateSelectFilter('completedJobFilter', data, 'Job Name');
            populateSelectFilter('completedUserFilter', data, 'User');
            populateSelectFilter('completedStatusFilter', data, 'Status');
        }

        function populateSelectFilter(selectId, data, column) {
            const select = document.getElementById(selectId);
            const currentValue = select.value;

            // Get unique values
            const uniqueValues = [...new Set(data.map(row => row[column]).filter(val => val && val !== 'Unknown'))].sort();

            // Clear and repopulate
            select.innerHTML = '<option value="">All</option>';
            uniqueValues.forEach(value => {
                const option = document.createElement('option');
                option.value = value;
                option.textContent = value;
                select.appendChild(option);
            });

            // Restore previous selection if it still exists
            if (currentValue && uniqueValues.includes(currentValue)) {
                select.value = currentValue;
            }
        }

        function applyRunningFilters() {
            // This would implement client-side filtering
            // For simplicity, we'll just refresh the data
            const sparkUrl = document.getElementById('sparkUrl').value;
            const yarnUrl = document.getElementById('yarnUrl').value;
            loadRunningJobs(sparkUrl, yarnUrl);
        }

        function applyCompletedFilters() {
            const sparkUrl = document.getElementById('sparkUrl').value;
            const yarnUrl = document.getElementById('yarnUrl').value;
            loadCompletedJobs(sparkUrl, yarnUrl);
        }

        function applySummaryFilters() {
            const sparkUrl = document.getElementById('sparkUrl').value;
            const yarnUrl = document.getElementById('yarnUrl').value;
            loadJobSummary(sparkUrl, yarnUrl);
        }

        function updateHourlyRange() {
            const range = document.getElementById('hourlyRange');
            const valueLabel = document.getElementById('hourlyRangeValue');
            valueLabel.textContent = range.value + ' hours';

            // Update table display
            updateHourlyTable(jobData.hourly, ['Submit Hour', 'Job Count', 'Total Memory (GB)', 'Avg Memory (GB)', 'Max Memory (GB)', 'Total vCores', 'Avg vCores', 'Max vCores', 'Avg Duration (mins)', 'Max Duration (mins)', 'Total Memory-Hours', 'Total vCore-Hours', 'Unique Users']);
        }

        function downloadCSV(dataType) {
            const sparkUrl = document.getElementById('sparkUrl').value;
            const yarnUrl = document.getElementById('yarnUrl').value;

            const url = `/download/${dataType}?spark_url=${encodeURIComponent(sparkUrl)}&yarn_url=${encodeURIComponent(yarnUrl)}`;

            // Create a temporary link and click it
            const link = document.createElement('a');
            link.href = url;
            link.download = `${dataType}_jobs.csv`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
    </script>
</body>
</html>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="completed-tab" data-bs-toggle="tab" data-bs-target="#completed"
                                type="button" role="tab">
                            <i class="fas fa-check-circle"></i> Completed Jobs
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="hourly-tab" data-bs-toggle="tab" data-bs-target="#hourly"
                                type="button" role="tab">
                            <i class="fas fa-chart-bar"></i> Hourly Aggregation
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="summary-tab" data-bs-toggle="tab" data-bs-target="#summary"
                                type="button" role="tab">
                            <i class="fas fa-list"></i> Job Summary
                        </button>
                    </li>