<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Snowflake Resource Monitor</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <!-- Navigation Sidebar -->
    <nav class="sidebar">
        <div class="sidebar-header">
            <div class="logo">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 2L2 7l10 5 10-5-10-5z"/>
                    <path d="M2 17l10 5 10-5"/>
                    <path d="M2 12l10 5 10-5"/>
                </svg>
                <span>Snowflake Monitor</span>
            </div>
        </div>
        
        <ul class="nav-menu">
            <li class="nav-item active" data-section="overview">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="3" width="7" height="7"/>
                    <rect x="14" y="3" width="7" height="7"/>
                    <rect x="14" y="14" width="7" height="7"/>
                    <rect x="3" y="14" width="7" height="7"/>
                </svg>
                <span>Overview</span>
            </li>
            <li class="nav-item" data-section="costs">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="12" y1="1" x2="12" y2="23"/>
                    <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
                </svg>
                <span>Cost Analysis</span>
            </li>
            <li class="nav-item" data-section="queries">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/>
                </svg>
                <span>Query Performance</span>
            </li>
            <li class="nav-item" data-section="warehouses">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="4" y="4" width="16" height="16" rx="2" ry="2"/>
                    <rect x="9" y="9" width="6" height="6"/>
                    <line x1="9" y1="1" x2="9" y2="4"/>
                    <line x1="15" y1="1" x2="15" y2="4"/>
                    <line x1="9" y1="20" x2="9" y2="23"/>
                    <line x1="15" y1="20" x2="15" y2="23"/>
                    <line x1="20" y1="9" x2="23" y2="9"/>
                    <line x1="20" y1="14" x2="23" y2="14"/>
                    <line x1="1" y1="9" x2="4" y2="9"/>
                    <line x1="1" y1="14" x2="4" y2="14"/>
                </svg>
                <span>Warehouses</span>
            </li>
            <li class="nav-item" data-section="bottlenecks">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
                    <line x1="12" y1="9" x2="12" y2="13"/>
                    <line x1="12" y1="17" x2="12.01" y2="17"/>
                </svg>
                <span>Bottlenecks</span>
            </li>
            <li class="nav-item" data-section="recommendations">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"/>
                    <line x1="12" y1="16" x2="12" y2="12"/>
                    <line x1="12" y1="8" x2="12.01" y2="8"/>
                </svg>
                <span>Recommendations</span>
            </li>
        </ul>
        
        <div class="sidebar-footer">
            <div class="refresh-control">
                <button id="refreshBtn" class="btn-refresh">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="23 4 23 10 17 10"/>
                        <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/>
                    </svg>
                    Refresh Data
                </button>
                <span class="last-refresh">Last updated: <span id="lastRefresh">Never</span></span>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Overview Section -->
        <section id="overview" class="content-section active">
            <div class="section-header">
                <h1>Dashboard Overview</h1>
                <p class="section-subtitle">Real-time monitoring of your Snowflake environment</p>
            </div>
            
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-icon credits">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <path d="M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8"/>
                            <path d="M12 18V6"/>
                        </svg>
                    </div>
                    <div class="metric-content">
                        <span class="metric-label">Credits (30d)</span>
                        <span class="metric-value" id="totalCredits">--</span>
                    </div>
                </div>
                
                <div class="metric-card">
                    <div class="metric-icon storage">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <ellipse cx="12" cy="5" rx="9" ry="3"/>
                            <path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/>
                            <path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/>
                        </svg>
                    </div>
                    <div class="metric-content">
                        <span class="metric-label">Storage</span>
                        <span class="metric-value" id="totalStorage">--</span>
                        <span class="metric-unit">TB</span>
                    </div>
                </div>
                
                <div class="metric-card">
                    <div class="metric-icon queries">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/>
                        </svg>
                    </div>
                    <div class="metric-content">
                        <span class="metric-label">Queries (24h)</span>
                        <span class="metric-value" id="queryCount">--</span>
                    </div>
                </div>
                
                <div class="metric-card">
                    <div class="metric-icon warehouses">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="4" y="4" width="16" height="16" rx="2" ry="2"/>
                            <rect x="9" y="9" width="6" height="6"/>
                        </svg>
                    </div>
                    <div class="metric-content">
                        <span class="metric-label">Active Warehouses</span>
                        <span class="metric-value" id="activeWarehouses">--</span>
                    </div>
                </div>
                
                <div class="metric-card">
                    <div class="metric-icon time">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <polyline points="12 6 12 12 16 14"/>
                        </svg>
                    </div>
                    <div class="metric-content">
                        <span class="metric-label">Avg Query Time</span>
                        <span class="metric-value" id="avgQueryTime">--</span>
                        <span class="metric-unit">sec</span>
                    </div>
                </div>
                
                <div class="metric-card alert">
                    <div class="metric-icon failed">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <line x1="15" y1="9" x2="9" y2="15"/>
                            <line x1="9" y1="9" x2="15" y2="15"/>
                        </svg>
                    </div>
                    <div class="metric-content">
                        <span class="metric-label">Failed Queries (24h)</span>
                        <span class="metric-value" id="failedQueries">--</span>
                    </div>
                </div>
            </div>
            
            <div class="charts-row">
                <div class="chart-card">
                    <div class="chart-header">
                        <h3>Credit Usage Trend (30 days)</h3>
                    </div>
                    <div class="chart-container">
                        <canvas id="costTrendChart"></canvas>
                    </div>
                </div>
                
                <div class="chart-card">
                    <div class="chart-header">
                        <h3>Storage by Database</h3>
                    </div>
                    <div class="chart-container">
                        <canvas id="storageChart"></canvas>
                    </div>
                </div>
            </div>
        </section>

        <!-- Cost Analysis Section -->
        <section id="costs" class="content-section">
            <div class="section-header">
                <h1>Cost Analysis</h1>
                <p class="section-subtitle">Detailed breakdown of credit consumption</p>
            </div>
            
            <div class="filter-bar">
                <select id="costDaysFilter" class="filter-select">
                    <option value="7">Last 7 days</option>
                    <option value="14">Last 14 days</option>
                    <option value="30" selected>Last 30 days</option>
                    <option value="60">Last 60 days</option>
                    <option value="90">Last 90 days</option>
                </select>
            </div>
            
            <div class="charts-row">
                <div class="chart-card wide">
                    <div class="chart-header">
                        <h3>Cost by Warehouse</h3>
                    </div>
                    <div class="chart-container">
                        <canvas id="warehouseCostChart"></canvas>
                    </div>
                </div>
            </div>
            
            <div class="charts-row">
                <div class="chart-card">
                    <div class="chart-header">
                        <h3>Cost by Database</h3>
                    </div>
                    <div class="chart-container">
                        <canvas id="databaseCostChart"></canvas>
                    </div>
                </div>
                
                <div class="chart-card">
                    <div class="chart-header">
                        <h3>Usage by Hour of Day</h3>
                    </div>
                    <div class="chart-container">
                        <canvas id="hourlyUsageChart"></canvas>
                    </div>
                </div>
            </div>
            
            <div class="data-table-card">
                <div class="table-header">
                    <h3>Warehouse Cost Details</h3>
                </div>
                <div class="table-container">
                    <table class="data-table" id="warehouseCostTable">
                        <thead>
                            <tr>
                                <th>Warehouse</th>
                                <th>Total Credits</th>
                                <th>Compute Credits</th>
                                <th>Cloud Services</th>
                                <th>Active Days</th>
                                <th>Avg Hourly</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Query Performance Section -->
        <section id="queries" class="content-section">
            <div class="section-header">
                <h1>Query Performance</h1>
                <p class="section-subtitle">Identify slow and resource-intensive queries</p>
            </div>
            
            <div class="filter-bar">
                <div class="filter-group">
                    <label>Min Duration (sec):</label>
                    <input type="number" id="queryThreshold" value="60" min="1" class="filter-input">
                </div>
                <div class="filter-group">
                    <label>Limit:</label>
                    <select id="queryLimit" class="filter-select">
                        <option value="25">25</option>
                        <option value="50" selected>50</option>
                        <option value="100">100</option>
                    </select>
                </div>
                <button id="applyQueryFilters" class="btn-apply">Apply Filters</button>
            </div>
            
            <div class="tabs">
                <button class="tab-btn active" data-tab="longRunning">Long Running</button>
                <button class="tab-btn" data-tab="expensive">Most Expensive</button>
                <button class="tab-btn" data-tab="queued">Queued Queries</button>
            </div>
            
            <div class="tab-content active" id="longRunning">
                <div class="data-table-card">
                    <div class="table-container">
                        <table class="data-table" id="longRunningTable">
                            <thead>
                                <tr>
                                    <th>Query ID</th>
                                    <th>User</th>
                                    <th>Warehouse</th>
                                    <th>Database</th>
                                    <th>Duration (s)</th>
                                    <th>GB Scanned</th>
                                    <th>Queue Time (s)</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <div class="tab-content" id="expensive">
                <div class="data-table-card">
                    <div class="table-container">
                        <table class="data-table" id="expensiveTable">
                            <thead>
                                <tr>
                                    <th>Query ID</th>
                                    <th>User</th>
                                    <th>Warehouse</th>
                                    <th>Database</th>
                                    <th>Duration (s)</th>
                                    <th>GB Scanned</th>
                                    <th>GB Written</th>
                                    <th>Rows Produced</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <div class="tab-content" id="queued">
                <div class="data-table-card">
                    <div class="table-container">
                        <table class="data-table" id="queuedTable">
                            <thead>
                                <tr>
                                    <th>Query ID</th>
                                    <th>User</th>
                                    <th>Warehouse</th>
                                    <th>Total (s)</th>
                                    <th>Queue Time (s)</th>
                                    <th>Provisioning (s)</th>
                                    <th>Execution (s)</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <div class="query-detail-modal" id="queryModal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>Query Details</h3>
                        <button class="modal-close">&times;</button>
                    </div>
                    <div class="modal-body">
                        <pre id="queryText"></pre>
                    </div>
                </div>
            </div>
        </section>

        <!-- Warehouses Section -->
        <section id="warehouses" class="content-section">
            <div class="section-header">
                <h1>Warehouse Management</h1>
                <p class="section-subtitle">Monitor warehouse configurations and cluster performance</p>
            </div>
            
            <div class="data-table-card">
                <div class="table-header">
                    <h3>Warehouse Configurations</h3>
                </div>
                <div class="table-container">
                    <table class="data-table" id="warehouseConfigTable">
                        <thead>
                            <tr>
                                <th>Warehouse</th>
                                <th>State</th>
                                <th>Size</th>
                                <th>Type</th>
                                <th>Min Clusters</th>
                                <th>Max Clusters</th>
                                <th>Scaling Policy</th>
                                <th>Auto Suspend (s)</th>
                                <th>Auto Resume</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
            
            <div class="charts-row">
                <div class="chart-card wide">
                    <div class="chart-header">
                        <h3>Cluster Concurrency (7 days)</h3>
                    </div>
                    <div class="chart-container">
                        <canvas id="clusterLoadChart"></canvas>
                    </div>
                </div>
            </div>
        </section>

        <!-- Bottlenecks Section -->
        <section id="bottlenecks" class="content-section">
            <div class="section-header">
                <h1>Bottleneck Analysis</h1>
                <p class="section-subtitle">Identify performance issues and resource constraints</p>
            </div>
            
            <div class="bottleneck-grid">
                <div class="bottleneck-card">
                    <div class="bottleneck-header queuing">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <polyline points="12 6 12 12 16 14"/>
                        </svg>
                        <h3>Query Queuing</h3>
                    </div>
                    <div class="bottleneck-content" id="queuingBottleneck">
                        <p class="loading">Loading...</p>
                    </div>
                </div>
                
                <div class="bottleneck-card">
                    <div class="bottleneck-header spilling">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 2v20M2 12h20"/>
                        </svg>
                        <h3>Disk Spilling</h3>
                    </div>
                    <div class="bottleneck-content" id="spillingBottleneck">
                        <p class="loading">Loading...</p>
                    </div>
                </div>
                
                <div class="bottleneck-card">
                    <div class="bottleneck-header compilation">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="16 18 22 12 16 6"/>
                            <polyline points="8 6 2 12 8 18"/>
                        </svg>
                        <h3>High Compilation Time</h3>
                    </div>
                    <div class="bottleneck-content" id="compilationBottleneck">
                        <p class="loading">Loading...</p>
                    </div>
                </div>
                
                <div class="bottleneck-card">
                    <div class="bottleneck-header failures">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <line x1="15" y1="9" x2="9" y2="15"/>
                            <line x1="9" y1="9" x2="15" y2="15"/>
                        </svg>
                        <h3>Query Failures</h3>
                    </div>
                    <div class="bottleneck-content" id="failuresBottleneck">
                        <p class="loading">Loading...</p>
                    </div>
                </div>
            </div>
            
            <div class="charts-row">
                <div class="chart-card">
                    <div class="chart-header">
                        <h3>Query Volume by Hour</h3>
                    </div>
                    <div class="chart-container">
                        <canvas id="queryPatternChart"></canvas>
                    </div>
                </div>
                
                <div class="chart-card">
                    <div class="chart-header">
                        <h3>Query Types Distribution</h3>
                    </div>
                    <div class="chart-container">
                        <canvas id="queryTypeChart"></canvas>
                    </div>
                </div>
            </div>
        </section>

        <!-- Recommendations Section -->
        <section id="recommendations" class="content-section">
            <div class="section-header">
                <h1>Optimization Recommendations</h1>
                <p class="section-subtitle">Actionable insights to improve performance and reduce costs</p>
            </div>
            
            <div class="recommendations-container" id="recommendationsContainer">
                <p class="loading">Analyzing your environment...</p>
            </div>
        </section>
    </main>

    <!-- Toast Notifications -->
    <div class="toast-container" id="toastContainer"></div>

    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>
